<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Metered billing | Laravel Cashier Mollie v2.x</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/cashier-mollie/assets/favicons/apple-touch-icon.png">
    <link rel="icon" href="/cashier-mollie/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/cashier-mollie/assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/cashier-mollie/assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="/cashier-mollie/assets/favicons/site.webmanifest">
    <link rel="mask-icon" href="/cashier-mollie/assets/favicons/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/cashier-mollie/assets/favicons/favicon.ico">
    <script src="https://cdn.usefathom.com/script.js" spa="auto" site="ANMLOYPH" defer="true"></script>
    <meta name="description" content="Laravel Cashier provides an expressive, fluent interface to subscriptions using Mollie's billing services.">
    <meta property="og:site_name" content="Laravel Cashier Mollie v2.x">
    <meta property="og:title" content="Metered billing">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.cashiermollie.com/05-metered.html">
    <meta name="twitter:title" content="Metered billing">
    <meta name="twitter:url" content="https://www.cashiermollie.com/05-metered.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Mollie.com">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/assets/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width">
    
    <link rel="preload" href="/cashier-mollie/assets/css/0.styles.85d7d458.css" as="style"><link rel="preload" href="/cashier-mollie/assets/js/app.aa2d4b3a.js" as="script"><link rel="preload" href="/cashier-mollie/assets/js/2.f1cc6911.js" as="script"><link rel="preload" href="/cashier-mollie/assets/js/13.e7f9933f.js" as="script"><link rel="preload" href="/cashier-mollie/assets/js/3.c5a105dd.js" as="script"><link rel="prefetch" href="/cashier-mollie/assets/js/10.d0dfd006.js"><link rel="prefetch" href="/cashier-mollie/assets/js/11.31762be8.js"><link rel="prefetch" href="/cashier-mollie/assets/js/12.70318d7a.js"><link rel="prefetch" href="/cashier-mollie/assets/js/14.4638779b.js"><link rel="prefetch" href="/cashier-mollie/assets/js/15.2475460a.js"><link rel="prefetch" href="/cashier-mollie/assets/js/16.45b98ac7.js"><link rel="prefetch" href="/cashier-mollie/assets/js/17.d10157c9.js"><link rel="prefetch" href="/cashier-mollie/assets/js/18.2b60d376.js"><link rel="prefetch" href="/cashier-mollie/assets/js/19.60230e04.js"><link rel="prefetch" href="/cashier-mollie/assets/js/20.80b8ea15.js"><link rel="prefetch" href="/cashier-mollie/assets/js/4.910b7cda.js"><link rel="prefetch" href="/cashier-mollie/assets/js/5.36aa556b.js"><link rel="prefetch" href="/cashier-mollie/assets/js/6.dd96bc00.js"><link rel="prefetch" href="/cashier-mollie/assets/js/7.00317da1.js"><link rel="prefetch" href="/cashier-mollie/assets/js/8.ebb547cf.js"><link rel="prefetch" href="/cashier-mollie/assets/js/9.048f1141.js">
    <link rel="stylesheet" href="/cashier-mollie/assets/css/0.styles.85d7d458.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cashier-mollie/" class="home-link router-link-active"><img src="/cashier-mollie/favicon.svg" alt="Laravel Cashier Mollie v2.x" class="logo"> <span class="site-name can-hide">Laravel Cashier Mollie v2.x</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/laravel/cashier-mollie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/laravel/cashier-mollie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/cashier-mollie/" aria-current="page" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/cashier-mollie/01-instalation.html" class="sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cashier-mollie/01-instalation.html#setup" class="sidebar-link">Setup</a></li></ul></li><li><a href="/cashier-mollie/02-subscriptions.html" class="sidebar-link">Subscriptions</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cashier-mollie/02-subscriptions.html#creating-subscriptions" class="sidebar-link">Creating subscriptions</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-subscriptions.html#checking-subscription-status" class="sidebar-link">Checking subscription status</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-subscriptions.html#cancelled-subscription-status" class="sidebar-link">Cancelled Subscription Status</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-subscriptions.html#changing-plans" class="sidebar-link">Changing Plans</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-subscriptions.html#subscription-quantity" class="sidebar-link">Subscription Quantity</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-subscriptions.html#subscription-taxes" class="sidebar-link">Subscription Taxes</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-subscriptions.html#subscription-anchor-date" class="sidebar-link">Subscription Anchor Date</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-subscriptions.html#cancelling-subscriptions" class="sidebar-link">Cancelling Subscriptions</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-subscriptions.html#resuming-subscriptions" class="sidebar-link">Resuming Subscriptions</a></li></ul></li><li><a href="/cashier-mollie/03-trials.html" class="sidebar-link">Subscription Trials</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cashier-mollie/03-trials.html#with-mandate-up-front" class="sidebar-link">With Mandate Up Front</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/03-trials.html#without-mandate-up-front" class="sidebar-link">Without Mandate Up Front</a></li></ul></li><li><a href="/cashier-mollie/04-oneoffcharges.html" class="sidebar-link">One-off charges</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cashier-mollie/04-oneoffcharges.html#simple-charges" class="sidebar-link">Simple charges</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/04-oneoffcharges.html#refunding-charges" class="sidebar-link">Refunding Charges</a></li></ul></li><li><a href="/cashier-mollie/05-metered.html" aria-current="page" class="active sidebar-link">Metered billing</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/cashier-mollie/06-customer.html" class="sidebar-link">Customer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cashier-mollie/06-customer.html#updating-customer-payment-mandates" class="sidebar-link">Updating Customer payment mandates</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/06-customer.html#customer-balance" class="sidebar-link">Customer balance</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/06-customer.html#customer-locale" class="sidebar-link">Customer locale</a></li></ul></li><li><a href="/cashier-mollie/07-invoices.html" class="sidebar-link">Invoices</a></li><li><a href="/cashier-mollie/08-events.html" class="sidebar-link">Cashier Events</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/cashier-mollie/09-webhook.html" class="sidebar-link">Webhook Event Handlers</a></li><li><a href="/cashier-mollie/10-testing.html" class="sidebar-link">Testing</a></li><li><a href="/cashier-mollie/11-faq.html" class="sidebar-link">F.A.Q.</a><ul class="sidebar-sub-headers"></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="metered-billing"><a href="#metered-billing" class="header-anchor">#</a> Metered billing</h1> <p>Some business cases will require dynamic subscription amounts.</p> <p>To allow for full flexibility Cashier Mollie allows you to define your own set of Subscription OrderItem preprocessors.
These preprocessors are invoked when the OrderItem is due, right before being processed into a Mollie payment.</p> <p>If you're using metered billing, this is a convenient place to calculate the amount based on the usage statistics and
reset any counters for the next billing cycle.</p> <p>You can define the preprocessors in the <code>cashier_plans</code> config file.</p> <h3 id="ok-so-how-does-this-all-actually-work"><a href="#ok-so-how-does-this-all-actually-work" class="header-anchor">#</a> Ok. So how does this all actually work?</h3> <p>This Cashier implementation schedules triggering payments from the client side, instead of relying on subscription management at Mollie.
(Yes, Mollie also offers a Subscription API, but it does not support all of Cashier features, so this package provides its own subscription engine.)</p> <p>From a high level perspective, this is what the process looks like:</p> <ol><li>A <code>Subscription</code> is created using the <code>MandatePaymentSubscriptionBuilder</code> (redirecting to Mollie's checkout to create
a <code>Mandate</code>) or <code>PremandatedSubscriptionBuilder</code> (using an existing <code>Mandate</code>).</li> <li>The <code>Subscription</code> yields a scheduled <code>OrderItem</code> at the beginning of each billing cycle.</li> <li><code>OrderItems</code> which are due are preprocessed and bundled into <code>Orders</code> whenever possible by a scheduled job (i.e.
daily). This is done so your customer will receive a single payment/invoice for multiple items later on in the chain).
Preprocessing the <code>OrderItems</code> may involve applying dynamic discounts or metered billing, depending on your
configuration.</li> <li>The <code>Order</code> is processed by the same scheduled job into a payment:
<ul><li>First, (if available) the customer's balance is processed in the <code>Order</code>.</li> <li>If the total due is positive, a Mollie payment is incurred.</li> <li>If the total due is 0, nothing happens.</li> <li>If the total due is negative, the amount is added to the user's balance. If the user has no active subscriptions left, the <code>BalanceTurnedStale</code> event will be raised.</li></ul></li> <li>You can generate an <code>Invoice</code> (html/pdf) for the user.</li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/laravel/cashier-mollie/edit/master/docs/05-metered.md" target="_blank" rel="noopener noreferrer">Improve this page (submit a PR)</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/23/2020, 9:12:14 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cashier-mollie/04-oneoffcharges.html" class="prev">
        One-off charges
      </a></span> <span class="next"><a href="/cashier-mollie/06-customer.html">
        Customer
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/cashier-mollie/assets/js/app.aa2d4b3a.js" defer></script><script src="/cashier-mollie/assets/js/2.f1cc6911.js" defer></script><script src="/cashier-mollie/assets/js/13.e7f9933f.js" defer></script><script src="/cashier-mollie/assets/js/3.c5a105dd.js" defer></script>
  </body>
</html>
