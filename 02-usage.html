<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Usage | Laravel Cashier Mollie</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/cashier-mollie/assets/favicons/apple-touch-icon.png">
    <link rel="icon" href="/cashier-mollie/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/cashier-mollie/assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/cashier-mollie/assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="/cashier-mollie/assets/favicons/site.webmanifest">
    <link rel="mask-icon" href="/cashier-mollie/assets/favicons/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/cashier-mollie/assets/favicons/favicon.ico">
    <meta name="description" content="Laravel Cashier provides an expressive, fluent interface to subscriptions using Mollie's billing services.">
    <meta property="og:site_name" content="Laravel Cashier Mollie">
    <meta property="og:title" content="Usage">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.cashiermollie.com/02-usage.html">
    <meta name="twitter:title" content="Usage">
    <meta name="twitter:url" content="https://www.cashiermollie.com/02-usage.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/assets/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width">
    
    <link rel="preload" href="/cashier-mollie/assets/css/0.styles.56931ce2.css" as="style"><link rel="preload" href="/cashier-mollie/assets/js/app.94b18de0.js" as="script"><link rel="preload" href="/cashier-mollie/assets/js/2.111e1301.js" as="script"><link rel="preload" href="/cashier-mollie/assets/js/10.2aabd776.js" as="script"><link rel="preload" href="/cashier-mollie/assets/js/3.a57d0152.js" as="script"><link rel="prefetch" href="/cashier-mollie/assets/js/11.5e00374a.js"><link rel="prefetch" href="/cashier-mollie/assets/js/12.1497dbe5.js"><link rel="prefetch" href="/cashier-mollie/assets/js/13.3d2748f5.js"><link rel="prefetch" href="/cashier-mollie/assets/js/14.9a969541.js"><link rel="prefetch" href="/cashier-mollie/assets/js/15.3fc088c7.js"><link rel="prefetch" href="/cashier-mollie/assets/js/4.88013e85.js"><link rel="prefetch" href="/cashier-mollie/assets/js/5.36aa556b.js"><link rel="prefetch" href="/cashier-mollie/assets/js/6.dd96bc00.js"><link rel="prefetch" href="/cashier-mollie/assets/js/7.92e639ca.js"><link rel="prefetch" href="/cashier-mollie/assets/js/8.ebb547cf.js"><link rel="prefetch" href="/cashier-mollie/assets/js/9.048f1141.js">
    <link rel="stylesheet" href="/cashier-mollie/assets/css/0.styles.56931ce2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/cashier-mollie/" class="home-link router-link-active"><img src="/cashier-mollie/favicon-32x32.png" alt="Laravel Cashier Mollie" class="logo"> <span class="site-name can-hide">Laravel Cashier Mollie</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/laravel/cashier-mollie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/laravel/cashier-mollie" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/cashier-mollie/" aria-current="page" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/cashier-mollie/01-instalation.html" class="sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cashier-mollie/01-instalation.html#setup" class="sidebar-link">Setup</a></li></ul></li><li><a href="/cashier-mollie/02-usage.html" aria-current="page" class="active sidebar-link">Usage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#creating-subscriptions" class="sidebar-link">Creating subscriptions</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#coupons" class="sidebar-link">Coupons</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#checking-subscription-status" class="sidebar-link">Checking subscription status</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#cancelled-subscription-status" class="sidebar-link">Cancelled Subscription Status</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#changing-plans" class="sidebar-link">Changing Plans</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#subscription-quantity" class="sidebar-link">Subscription Quantity</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#subscription-taxes" class="sidebar-link">Subscription Taxes</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#subscription-anchor-date" class="sidebar-link">Subscription Anchor Date</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#cancelling-subscriptions" class="sidebar-link">Cancelling Subscriptions</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#resuming-subscriptions" class="sidebar-link">Resuming Subscriptions</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#updating-customer-payment-mandates" class="sidebar-link">Updating Customer payment mandates</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#subscription-trials" class="sidebar-link">Subscription Trials</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#without-mandate-up-front" class="sidebar-link">Without Mandate Up Front</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#defining-webhook-event-handlers" class="sidebar-link">Defining Webhook Event Handlers</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#one-off-charges" class="sidebar-link">One-off charges</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#invoices" class="sidebar-link">Invoices</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#refunding-charges" class="sidebar-link">Refunding Charges</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#customer-balance" class="sidebar-link">Customer balance</a></li><li class="sidebar-sub-header"><a href="/cashier-mollie/02-usage.html#customer-locale" class="sidebar-link">Customer locale</a></li></ul></li><li><a href="/cashier-mollie/03-events.html" class="sidebar-link">Cashier Events</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/cashier-mollie/04-metered.html" class="sidebar-link">Metered billing</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/cashier-mollie/05-faq.html" class="sidebar-link">F.A.Q.</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/cashier-mollie/06-testing.html" class="sidebar-link">Testing</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h1> <h2 id="creating-subscriptions"><a href="#creating-subscriptions" class="header-anchor">#</a> Creating subscriptions</h2> <p>To create a subscription, first retrieve an instance of your billable model, which typically will be an instance of
<code>App\User</code>. Once you have retrieved the model instance, you may use the <code>newSubscription</code> method to create the model's
subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Make sure to configure the 'premium' plan in config/cashier_plans.php</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">newSubscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'premium'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the customer already has a valid Mollie mandate, the <code>$result</code> will be a <code>Subscription</code>.</p> <p>If the customer has no valid Mollie mandate yet, the <code>$result</code> will be a <code>RedirectToCheckoutResponse</code>, redirecting the
customer to the Mollie checkout to make the first payment. Once the payment has been received the subscription will
start.</p> <p>Here's a basic controller example for creating the subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Cashier<span class="token punctuation">\</span>SubscriptionBuilder<span class="token punctuation">\</span>RedirectToCheckoutResponse</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Auth</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CreateSubscriptionController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @param string $plan
     * @return \Illuminate\Http\RedirectResponse
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span>string <span class="token variable">$plan</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$user</span> <span class="token operator">=</span> Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">ucfirst</span><span class="token punctuation">(</span><span class="token variable">$plan</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">' membership'</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscribed</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$plan</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">newSubscription</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$plan</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_a</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">,</span> RedirectToCheckoutResponse<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span> <span class="token comment">// Redirect to Mollie checkout</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'status'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Welcome to the '</span> <span class="token punctuation">.</span> <span class="token variable">$plan</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">' plan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'status'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'You are already on the '</span> <span class="token punctuation">.</span> <span class="token variable">$plan</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">' plan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In order to always enforce a redirect to the Mollie checkout page, use the <code>newSubscriptionViaMollieCheckout</code> method
instead of <code>newSubscription</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$redirect</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">newSubscriptionViaMollieCheckout</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'premium'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// make sure to configure the 'premium' plan in config/cashier.php</span>
</code></pre></div><h2 id="coupons"><a href="#coupons" class="header-anchor">#</a> Coupons</h2> <p>Coupon handling in Cashier Mollie is designed with full flexibility in mind.</p> <p>Coupons can be defined in <code>config/cashier_coupons.php</code>.</p> <p>You can provide your own coupon handler by extending
<code>\Cashier\Discount\BaseCouponHandler</code>.</p> <p>Out of the box, a basic <code>FixedDiscountHandler</code> is provided.</p> <h3 id="redeeming-a-coupon-for-an-existing-subscription"><a href="#redeeming-a-coupon-for-an-existing-subscription" class="header-anchor">#</a> Redeeming a coupon for an existing subscription</h3> <p>For redeeming a coupon for an existing subscription, use the <code>redeemCoupon()</code> method on the billable trait:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">redeemCoupon</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'your-coupon-code'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will validate the coupon code and redeem it. The coupon will be applied to the upcoming Order.</p> <p>Optionally, specify the subscription it should be applied to:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">redeemCoupon</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'your-coupon-code'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>By default all other active redeemed coupons for the subscription will be revoked. You can prevent this by setting the
<code>$revokeOtherCoupons</code> flag to false:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">redeemCoupon</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'your-coupon-code'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'main'</span><span class="token punctuation">,</span> <span class="token boolean constant">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="checking-subscription-status"><a href="#checking-subscription-status" class="header-anchor">#</a> Checking subscription status</h2> <p>Once a user is subscribed to your application, you may easily check their subscription status using a variety of convenient methods. First, the <code>subscribed</code> method returns <code>true</code> if the user has an active subscription, even if the subscription is currently within its trial period:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscribed</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>subscribed</code> method also makes a great candidate for a <a href="https://www.laravel.com/docs/middleware" target="_blank" rel="noopener noreferrer">route middleware<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, allowing you to filter access to routes and controllers based on the user's subscription status:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> Closure <span class="token variable">$next</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscribed</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// This user is not a paying customer...</span>
        <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'billing'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token variable">$next</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you would like to determine if a user is still within their trial period, you may use the <code>onTrial</code> method. This method can be useful for displaying a warning to the user that they are still on their trial period:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onTrial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>subscribedToPlan</code> method may be used to determine if the user is subscribed to a given plan based on a configured plan. In this example, we will determine if the user's <code>main</code> subscription is actively subscribed to the <code>monthly</code> plan:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscribedToPlan</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'monthly'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="cancelled-subscription-status"><a href="#cancelled-subscription-status" class="header-anchor">#</a> Cancelled Subscription Status</h2> <p>To determine if the user was once an active subscriber, but has cancelled their subscription, you may use the <code>cancelled</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">cancelled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You may also determine if a user has cancelled their subscription, but are still on their &quot;grace period&quot; until the subscription fully expires. For example, if a user cancels a subscription on March 5th that was originally scheduled to expire on March 10th, the user is on their &quot;grace period&quot; until March 10th. Note that the <code>subscribed</code> method still returns <code>true</code> during this time:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onGracePeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="changing-plans"><a href="#changing-plans" class="header-anchor">#</a> Changing Plans</h2> <p>After a user is subscribed to your application, they may occasionally want to change to a new subscription plan. To swap a user to a new subscription, pass the plan's identifier to the <code>swap</code> or <code>swapNextCycle</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Swap right now</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'other-plan-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Swap once the current cycle has completed</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">swapNextCycle</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'other-plan-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>If the user is on trial, the trial period will be maintained. Also, if a &quot;quantity&quot; exists for the subscription, that quantity will also be maintained.</p> <h2 id="subscription-quantity"><a href="#subscription-quantity" class="header-anchor">#</a> Subscription Quantity</h2> <p>Sometimes subscriptions are affected by &quot;quantity&quot;. For example, your application might charge €10 per month <strong>per user</strong> on an account. To easily increment or decrement your subscription quantity, use the <code>incrementQuantity</code> and <code>decrementQuantity</code> methods:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">incrementQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add five to the subscription's current quantity...</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">incrementQuantity</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">decrementQuantity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Subtract five to the subscription's current quantity...</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">decrementQuantity</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternatively, you may set a specific quantity using the <code>updateQuantity</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">updateQuantity</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="subscription-taxes"><a href="#subscription-taxes" class="header-anchor">#</a> Subscription Taxes</h2> <p>To specify the tax percentage a user pays on a subscription, implement the <code>taxPercentage</code> method on your billable model, and return a numeric value between 0 and 100, with no more than 2 decimal places.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">taxPercentage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>taxPercentage</code> method enables you to apply a tax rate on a model-by-model basis, which may be helpful for a user base that spans multiple countries and tax rates.</p> <h3 id="syncing-tax-percentages"><a href="#syncing-tax-percentages" class="header-anchor">#</a> Syncing Tax Percentages</h3> <p>When changing the hard-coded value returned by the <code>taxPercentage</code> method, the tax settings on any existing subscriptions for the user will remain the same. If you wish to update the tax value for existing subscriptions with the returned <code>taxPercentage</code> value, you should call the <code>syncTaxPercentage</code> method on the user's subscription instance:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">syncTaxPercentage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="subscription-anchor-date"><a href="#subscription-anchor-date" class="header-anchor">#</a> Subscription Anchor Date</h2> <p>Not (yet) implemented, but you could make this work by scheduling <code>Cashier::run()</code> to only execute on a specific day of the month.</p> <h2 id="cancelling-subscriptions"><a href="#cancelling-subscriptions" class="header-anchor">#</a> Cancelling Subscriptions</h2> <p>To cancel a subscription, call the <code>cancel</code> method on the user's subscription:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>or</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">cancelAt</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When a subscription is cancelled, Cashier will automatically set the <code>ends_at</code> column in your database. This column is used to know when the <code>subscribed</code> method should begin returning <code>false</code>. For example, if a customer cancels a subscription on March 1st, but the subscription was not scheduled to end until March 5th, the <code>subscribed</code> method will continue to return <code>true</code> until March 5th.</p> <p>You may determine if a user has cancelled their subscription but are still on their &quot;grace period&quot; using the <code>onGracePeriod</code> method:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onGracePeriod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="resuming-subscriptions"><a href="#resuming-subscriptions" class="header-anchor">#</a> Resuming Subscriptions</h2> <p>If a user has cancelled their subscription and you wish to resume it, use the <code>resume</code> method. The user <strong>must</strong> still be on their grace period in order to resume a subscription:</p> <div class="language- extra-class"><pre><code>$user-&gt;subscription('main')-&gt;resume();
</code></pre></div><p>If the user cancels a subscription and then resumes that subscription before the subscription has fully expired, they will not be billed immediately. Instead, their subscription will be re-activated, and they will be billed on the original billing cycle.</p> <h2 id="updating-customer-payment-mandates"><a href="#updating-customer-payment-mandates" class="header-anchor">#</a> Updating Customer payment mandates</h2> <p>Coming soon.</p> <h2 id="subscription-trials"><a href="#subscription-trials" class="header-anchor">#</a> Subscription Trials</h2> <h3 id="with-mandate-up-front"><a href="#with-mandate-up-front" class="header-anchor">#</a> With Mandate Up Front</h3> <p>If you would like to offer trial periods to your customers while still collecting payment method information up front, you should use the <code>trialDays</code> method when creating your subscriptions:</p> <div class="language- extra-class"><pre class="language-text"><code>$user = User::find(1);

$user-&gt;newSubscription('main', 'monthly')
            -&gt;trialDays(10)
            -&gt;create();
</code></pre></div><p>This method will set the trial period ending date on the subscription record within the database.</p> <blockquote><p>{note} The customer will be redirected to the Mollie checkout page to make the first payment in order to register a mandate. You can modify the amount in the cashier config file.</p></blockquote> <blockquote><p>{note} If the customer's subscription is not cancelled before the trial ending date they will be charged as soon as the trial expires, so you should be sure to notify your users of their trial ending date.</p></blockquote> <p>The <code>trialUntil</code> method allows you to provide a <code>Carbon</code> instance to specify when the trial period should end:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Carbon<span class="token punctuation">\</span>Carbon</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">newSubscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'monthly'</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">trialUntil</span><span class="token punctuation">(</span>Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addDays</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You may determine if the user is within their trial period using either the <code>onTrial</code> method of the user instance, or the <code>onTrial</code> method of the subscription instance. The two examples below are identical:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onTrial</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onTrial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="without-mandate-up-front"><a href="#without-mandate-up-front" class="header-anchor">#</a> Without Mandate Up Front</h2> <p>If you would like to offer trial periods without collecting the user's payment method information up front, you may set the <code>trial_ends_at</code> column on the user record to your desired trial ending date. This is typically done during user registration:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// Populate other user properties...</span>
    <span class="token single-quoted-string string">'trial_ends_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addDays</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>{note}  Be sure to add a <a href="https://laravel.com/docs/eloquent-mutators#date-mutators" target="_blank" rel="noopener noreferrer">date mutator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for <code>trial_ends_at</code> to your model definition.</p></blockquote> <p>Cashier refers to this type of trial as a &quot;generic trial&quot;, since it is not attached to any existing subscription. The <code>onTrial</code> method on the <code>User</code> instance will return <code>true</code> if the current date is not past the value of <code>trial_ends_at</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onTrial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// User is within their trial period...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You may also use the <code>onGenericTrial</code> method if you wish to know specifically that the user is within their &quot;generic&quot; trial period and has not created an actual subscription yet:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">onGenericTrial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// User is within their &quot;generic&quot; trial period...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Once you are ready to create an actual subscription for the user, you may use the <code>newSubscription</code> method as usual:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">newSubscription</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'main'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'monthly'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="defining-webhook-event-handlers"><a href="#defining-webhook-event-handlers" class="header-anchor">#</a> Defining Webhook Event Handlers</h2> <p>Cashier automatically handles subscription cancellation on failed charges.</p> <p>Additionally, listen for the following events (in the <code>Laravel\Cashier\Events</code> namespace) to add app specific behaviour:</p> <ul><li><code>OrderPaymentPaid</code> and <code>OrderPaymentFailed</code></li> <li><code>FirstPaymentPaid</code> and <code>FirstPaymentFailed</code></li></ul> <h2 id="one-off-charges"><a href="#one-off-charges" class="header-anchor">#</a> One-off charges</h2> <p>Coming soon.</p> <h2 id="invoices"><a href="#invoices" class="header-anchor">#</a> Invoices</h2> <p>Listen for the <code>OrderInvoiceAvailable</code> event (in the <code>Laravel\Cashier\Events</code> namespace).
When a new order has been processed, you can grab the invoice by</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$invoice</span> <span class="token operator">=</span> <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">invoice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$invoice</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// get a Blade view</span>
<span class="token variable">$invoice</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pdf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// get a pdf of the Blade view</span>
<span class="token variable">$invoice</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// get a download response for the pdf</span>
</code></pre></div><p>To list invoices, access the user's orders using: <code>$user-&gt;orders-&gt;invoices()</code>.
This includes invoices for all orders, even unprocessed or failed orders.</p> <p>For list of invoices</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;list-unstyled&quot;</span><span class="token operator">&gt;</span>
    @<span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">orders</span> <span class="token keyword">as</span> <span class="token variable">$order</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
        
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token double-quoted-string string">&quot;/download-invoice/{{ <span class="token interpolation"><span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span></span> }}&quot;</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">invoice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">-</span>  <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">invoice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    @<span class="token keyword">endforeach</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</code></pre></div><p>and add this route inside web.php</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'auth'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/download-invoice/{orderId}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$orderId</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">downloadInvoice</span><span class="token punctuation">(</span><span class="token variable">$orderId</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="refunding-charges"><a href="#refunding-charges" class="header-anchor">#</a> Refunding Charges</h2> <p>Coming soon.</p> <h2 id="customer-balance"><a href="#customer-balance" class="header-anchor">#</a> Customer balance</h2> <p>In some cases (i.e. when swapping to a cheaper plan), a customer can have overpaid. The amount that has been overpaid
will be added to the customer balance.</p> <p>The customer balance is automatically processed in each Order.</p> <p>A separate balance is kept for each currency.</p> <p>There are a few methods available to interact with the balance directly.
<strong>Use these with care:</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$credit</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">credit</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'EUR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addCredit</span><span class="token punctuation">(</span><span class="token function">money</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'EUR'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// add €10.00</span>
<span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasCredit</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'EUR'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>When an Order with a negative total amount due is processed, that amount is credited to the user balance.
A <code>BalanceTurnedStale</code> event will be raised if the user has no active subscriptions at that moment.
Listen for this event if you'd like to refund the remaining balance and/or want to notify the user.</p> <h2 id="customer-locale"><a href="#customer-locale" class="header-anchor">#</a> Customer locale</h2> <p>Mollie provides a checkout tailored to the customer's locale. For this it guesses the visitor's locale. To override the
default locale, configure it in <code>config/cashier.php</code>. This is convenient for servicing a single country.</p> <p>If you're dealing with multiple locales and want to override Mollie's default behaviour, implement the <code>getLocale()</code>
method on the billable model. A common way is to add a nullable <code>locale</code> field to the user table and retrieve its value:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
     * @return string
     * @link https://docs.mollie.com/reference/v2/payments-api/create-payment#parameters
     * @example 'nl_NL'
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">locale</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/laravel/cashier-mollie/edit/master/docs/02-usage.md" target="_blank" rel="noopener noreferrer">Improve this page (submit a PR)</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/23/2020, 2:44:46 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cashier-mollie/01-instalation.html" class="prev">
        Installation
      </a></span> <span class="next"><a href="/cashier-mollie/03-events.html">
        Cashier Events
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/cashier-mollie/assets/js/app.94b18de0.js" defer></script><script src="/cashier-mollie/assets/js/2.111e1301.js" defer></script><script src="/cashier-mollie/assets/js/10.2aabd776.js" defer></script><script src="/cashier-mollie/assets/js/3.a57d0152.js" defer></script>
  </body>
</html>
